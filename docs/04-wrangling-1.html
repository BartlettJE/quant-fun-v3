<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Materials for the MSc Conversion Research Methods 1 and 2 courses at the University of Glasgow School of Psychology &amp; Neuroscience.">
<title>Fundamentals of Quantitative Analysis - 4&nbsp; Data wrangling 1: Join, select, and mutate</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05-wrangling-2.html" rel="next">
<link href="./03-intro-data-viz.html" rel="prev">
<link href="./images/logos/logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
<link rel="stylesheet" href="include/booktem.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/glossary.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./04-wrangling-1.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data wrangling 1: Join, select, and mutate</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Fundamentals of Quantitative Analysis</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/BartlettJE/quant-fun-v3/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-foreword.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to use this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-programming-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to programming with R/R Studio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-starting-with-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Creating Reproducible Documents</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-intro-data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Data Visualisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-wrangling-1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data wrangling 1: Join, select, and mutate</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-wrangling-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data wrangling 2: Filter, summarise, and pipes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-wrangling-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Wrangling 3: Pivots</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-more-visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Building your data visualisation skills</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-lm-continuous.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regression with one continuous predictor</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-lm-categorical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Regression with one categorical predictor</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical Power</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-screening-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Screening Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">One-way ANOVA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-factorial-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Factorial ANOVA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-multiple-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Multiple Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-dissertation-prep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Dissertation Preparation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-analysis-journeys.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis Journeys</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-analysis-journey-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Analysis Journey 1: Data Wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-analysis-journey-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Analysis Journey 2: Simple Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-analysis-journey-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Analysis Journey 3: ANOVA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-analysis-journey-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Analysis Journey 4: Multiple Linear Regression.</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-a-installing-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Installing <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-a1-updating-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Updating packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-a2-additional-learning-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Additional Resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-a3-How-to-cite-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Citing R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-b-symbols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Symbols</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-d-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-y-license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#chapter-preparation" id="toc-chapter-preparation" class="nav-link active" data-scroll-target="#chapter-preparation"><span class="header-section-number">4.1</span> Chapter preparation</a>
  <ul class="collapse">
<li><a href="#introduction-to-the-data-set" id="toc-introduction-to-the-data-set" class="nav-link" data-scroll-target="#introduction-to-the-data-set"><span class="header-section-number">4.1.1</span> Introduction to the data set</a></li>
  <li><a href="#organising-your-files-and-project-for-the-chapter" id="toc-organising-your-files-and-project-for-the-chapter" class="nav-link" data-scroll-target="#organising-your-files-and-project-for-the-chapter"><span class="header-section-number">4.1.2</span> Organising your files and project for the chapter</a></li>
  <li><a href="#activity-1---load-tidyverse-and-read-the-data-files" id="toc-activity-1---load-tidyverse-and-read-the-data-files" class="nav-link" data-scroll-target="#activity-1---load-tidyverse-and-read-the-data-files"><span class="header-section-number">4.1.3</span> Activity 1 - Load <code>tidyverse</code> and read the data files</a></li>
  </ul>
</li>
  <li><a href="#tidyverse-and-the-dplyr-package" id="toc-tidyverse-and-the-dplyr-package" class="nav-link" data-scroll-target="#tidyverse-and-the-dplyr-package"><span class="header-section-number">4.2</span> Tidyverse and the dplyr package</a></li>
  <li>
<a href="#joining-two-data-frames-with-_join-functions" id="toc-joining-two-data-frames-with-_join-functions" class="nav-link" data-scroll-target="#joining-two-data-frames-with-_join-functions"><span class="header-section-number">4.3</span> Joining two data frames with <code>*_join()</code> functions</a>
  <ul class="collapse">
<li><a href="#activity-2---join-the-files-together" id="toc-activity-2---join-the-files-together" class="nav-link" data-scroll-target="#activity-2---join-the-files-together"><span class="header-section-number">4.3.1</span> Activity 2 - Join the files together</a></li>
  </ul>
</li>
  <li><a href="#selecting-variables-of-interest-with-select" id="toc-selecting-variables-of-interest-with-select" class="nav-link" data-scroll-target="#selecting-variables-of-interest-with-select"><span class="header-section-number">4.4</span> Selecting variables of interest with <code>select()</code></a></li>
  <li><a href="#arranging-variables-of-interest-with-arrange" id="toc-arranging-variables-of-interest-with-arrange" class="nav-link" data-scroll-target="#arranging-variables-of-interest-with-arrange"><span class="header-section-number">4.5</span> Arranging variables of interest with <code>arrange()</code></a></li>
  <li><a href="#creating-or-modifying-variables-with-mutate" id="toc-creating-or-modifying-variables-with-mutate" class="nav-link" data-scroll-target="#creating-or-modifying-variables-with-mutate"><span class="header-section-number">4.6</span> Creating or modifying variables with <code>mutate()</code></a></li>
  <li>
<a href="#six-functions-for-wrangling-the-babynames" id="toc-six-functions-for-wrangling-the-babynames" class="nav-link" data-scroll-target="#six-functions-for-wrangling-the-babynames"><span class="header-section-number">4.7</span> Six functions for wrangling the <code>babynames</code></a>
  <ul class="collapse">
<li><a href="#dw1-a4" id="toc-dw1-a4" class="nav-link" data-scroll-target="#dw1-a4"><span class="header-section-number">4.7.1</span> Activity 4: Selecting variables of interest with <code>select()</code></a></li>
  <li><a href="#dw1-a5" id="toc-dw1-a5" class="nav-link" data-scroll-target="#dw1-a5"><span class="header-section-number">4.7.2</span> Activity 5: Arranging the data with <code>arrange()</code></a></li>
  <li><a href="#dw1-a7" id="toc-dw1-a7" class="nav-link" data-scroll-target="#dw1-a7"><span class="header-section-number">4.7.3</span> Activity 7: Creating new variables with <code>mutate()</code></a></li>
  </ul>
</li>
  <li>
<a href="#ld-test" id="toc-ld-test" class="nav-link" data-scroll-target="#ld-test"><span class="header-section-number">4.8</span> Test yourself</a>
  <ul class="collapse">
<li><a href="#knowledge-check" id="toc-knowledge-check" class="nav-link" data-scroll-target="#knowledge-check"><span class="header-section-number">4.8.1</span> Knowledge check</a></li>
  <li><a href="#error-mode" id="toc-error-mode" class="nav-link" data-scroll-target="#error-mode"><span class="header-section-number">4.8.2</span> Error mode</a></li>
  </ul>
</li>
  <li><a href="#words-from-this-chapter" id="toc-words-from-this-chapter" class="nav-link" data-scroll-target="#words-from-this-chapter"><span class="header-section-number">4.9</span> Words from this Chapter</a></li>
  <li><a href="#end-of-chapter" id="toc-end-of-chapter" class="nav-link" data-scroll-target="#end-of-chapter"><span class="header-section-number">4.10</span> End of Chapter</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/BartlettJE/quant-fun-v3/edit/main/04-wrangling-1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/BartlettJE/quant-fun-v3/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/BartlettJE/quant-fun-v3/blob/main/04-wrangling-1.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="04-wrangling-1" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data wrangling 1: Join, select, and mutate</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>In this chapter, we start our exploration of <a href="https://psyteachr.github.io/glossary/d#data-wrangling" target="_blank" class="glossary" title="The process of preparing data for visualisation and statistical analysis.">data wrangling</a>. Some of you might have experience painstakingly copying and pasting values into new columns or trying to match up values from multiple spreadsheets. As well as taking a long time, there is so much room for error as you might repeat or miss values.</p>
<p>We have mentioned a few times now the benefits of working with R/RStudio to develop reproducible research practices over the first few chapters.But, if you take nothing else away from these materials, developing your data wrangling skills is one of the primary benefits that will benefit you in many assessments and careers.</p>
<p>Researchers actually spend far more of their time cleaning and preparing their data than they spend analysing it. <span class="citation" data-cites="dasu2003">Dasu &amp; Johnson (<a href="references.html#ref-dasu2003" role="doc-biblioref">2003</a>)</span> estimated that up to 80% of time spent on data analysis involves data preparation tasks! Although every data set presents unique challenges, there are some systematic principles that you will constantly use to make your analyses less error-prone and more efficient. Our mantra is: the data changes but the skills stay the same.</p>
<p>Over the next three chapters, we are going to introduce you to a range of functions within the <code>tidyverse</code> for wrangling data. In this chapter, we will cover joining two data sets by a common identifier, selecting columns to simplify your data, arranging values within a data set, and mutating data to create new variables.</p>
<p><strong>Chapter Intended Learning Outcomes (ILOs)</strong></p>
<p>By the end of this chapter, you will be able to:</p>
<ul>
<li>ILO1</li>
</ul>
<section id="chapter-preparation" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="chapter-preparation">
<span class="header-section-number">4.1</span> Chapter preparation</h2>
<section id="introduction-to-the-data-set" class="level3" data-number="4.1.1"><h3 data-number="4.1.1" class="anchored" data-anchor-id="introduction-to-the-data-set">
<span class="header-section-number">4.1.1</span> Introduction to the data set</h3>
<p>For this chapter, we are using open data from <span class="citation" data-cites="woodworth_data_2018">Woodworth et al. (<a href="references.html#ref-woodworth_data_2018" role="doc-biblioref">2018</a>)</span> one more time. In the last two chapters, we asked you to trust us and copy some code until we reached data wrangling, and now is the time to fill in those gaps. If you need a reminder, the abstract of their article is:</p>
<blockquote class="blockquote">
<p>We present two datasets. The first dataset comprises 992 point-in-time records of self-reported happiness and depression in 295 participants, each assigned to one of four intervention groups, in a study of the effect of web-based positive-psychology interventions. Each point-in-time measurement consists of a participant’s responses to the 24 items of the Authentic Happiness Inventory and to the 20 items of the Center for Epidemiological Studies Depression (CES-D) scale. Measurements were sought at the time of each participant’s enrolment in the study and on five subsequent occasions, the last being approximately 189 days after enrolment. The second dataset contains basic demographic information about each participant.</p>
</blockquote>
<p>In summary, we have one data set containing demographic information about participants and a second data set containing measurements of two scales on happiness and depression.</p>
</section><section id="organising-your-files-and-project-for-the-chapter" class="level3" data-number="4.1.2"><h3 data-number="4.1.2" class="anchored" data-anchor-id="organising-your-files-and-project-for-the-chapter">
<span class="header-section-number">4.1.2</span> Organising your files and project for the chapter</h3>
<p>Before we can get started, you need to organise your files and project for the chapter, so your working directory is in order.</p>
<ol type="1">
<li><p>In your folder for research methods and the book <code>ResearchMethods1_2/Quant_Fundamentals</code>, create a new folder called <code>Chapter_04_06_datawrangling</code>. As we are spending three chapters on data wrangling, we will work within one folder. Within <code>Chapter_04_06_datawrangling</code>, create two new folders called <code>data</code> and <code>figures</code>.</p></li>
<li><p>Create an R Project for <code>Chapter_04_06_datawrangling</code> as an existing directory for your chapter folder. This should now be your working directory.</p></li>
<li><p>We will work within one folder, but create a new R Markdown for each chapter. Create a new R Markdown document and give it a sensible title describing the chapter, such as <code>04 Data Wrangling 1</code>. Delete everything below line 10 so you have a blank file to work with and save the file in your <code>Chapter_04_06_datawrangling</code> folder.</p></li>
<li><p>If you already have the two files from chapter 3, copy and paste them into the <code>data/</code> folder. If you need to download them again, the links are data file one (<a href="data/ahi-cesd.csv">ahi-cesd.csv</a>) and data file two (<a href="data/participant_info.csv">participant-info.csv</a>). Right click the links and select “save link as”, or clicking the links will save the files to your Downloads. Make sure that both files are saved as “.csv”. Save or copy the file to your <code>data/</code> folder within <code>Chapter_04_06_datawrangling</code>.</p></li>
</ol>
<p>You are now ready to start working on the chapter!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reminder of file management if you use the online server
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If we support you to use the online University of Glasgow R Server, working with files is a little different. If you downloaded R / RStudio to your own computer or you are using one of the library/lab computers, please ignore this section.</p>
<ol type="1">
<li><p>Log on to the <strong>R server</strong> using the link we provided to you.</p></li>
<li><p>In the file pane, click <code>New folder</code> and create the same structure we demonstrated above.</p></li>
<li><p>Download these two data files which we used in Chapter 3. Data file one: <a href="data/ahi-cesd.csv">ahi-cesd.csv</a>. Data file two: <a href="data/participant_info.csv">participant-info.csv</a>. Save the two files into the <code>data</code> folder you created for chapter 3. To download a file from this book, right click the link and select “save link as”. Make sure that both files are saved as “.csv”. Do not open them on your machine as often other software like Excel can change setting and ruin the files.</p></li>
<li><p>Now that the files are stored on your computer, go to RStudio on the server and click <code>Upload</code> then <code>Browse</code> and choose the folder for the chapter you are working on.</p></li>
<li><p>Click <code>Choose file</code> and go and find the data you want to upload.</p></li>
</ol>
</div>
</div>
</div>
</section><section id="activity-1---load-tidyverse-and-read-the-data-files" class="level3" data-number="4.1.3"><h3 data-number="4.1.3" class="anchored" data-anchor-id="activity-1---load-tidyverse-and-read-the-data-files">
<span class="header-section-number">4.1.3</span> Activity 1 - Load <code>tidyverse</code> and read the data files</h3>
<p>As the first activity, try and test yourself by loading <code>tidyverse</code> and reading the two data files. As a prompt, save the data files to these two object names to be consistent with the activities below, but you can check your answer below if you are stuck.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load the tidyverse package below</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># Load the two data files</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># This should be the ahi-cesd.csv file </span></span>
<span id="cb1-5"><a href="#cb1-5"></a>dat <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># This should be the participant-info.csv file</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>pinfo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Show me the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You should have the following in a code chunk:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Load the tidyverse package below</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># Load the two data files</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co"># This should be the ahi-cesd.csv file </span></span>
<span id="cb2-6"><a href="#cb2-6"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/ahi-cesd.csv"</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># This should be the participant-info.csv file</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>pinfo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/participant-info.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section></section><section id="tidyverse-and-the-dplyr-package" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="tidyverse-and-the-dplyr-package">
<span class="header-section-number">4.2</span> Tidyverse and the dplyr package</h2>
<p>So far, we have loaded a <a href="https://psyteachr.github.io/glossary/p#package" target="_blank" class="glossary" title="A group of R functions.">package</a> called <code>tidyverse</code> in every chapter and it is going to be at the core of all the data skills you develop. The <code>tidyverse</code> <a href="https://www.tidyverse.org/" target="_blank">https://www.tidyverse.org/</a> <span class="citation" data-cites="tidyverse">(<a href="references.html#ref-tidyverse" role="doc-biblioref">Wickham, 2017</a>)</span> is an ecosystem containing six core packages: <code>dplyr</code>, <code>tidyr</code>, <code>readr</code>, <code>purrr</code>, <code>ggplot2</code>, and <code>tibble</code>. Within these six core packages, you have access to <a href="https://psyteachr.github.io/glossary/f#function" target="_blank" class="glossary" title="A named section of code that can be reused.">functions</a> that will pretty much cover everything you need to wrangle and visualise your data.</p>
<p>In chapter 3, we introduced you to the package <code>ggplot2</code> for data visualisation. In this chapter, we focus on functions from the <a href="https://dplyr.tidyverse.org/" target="_blank"><code>dplyr</code></a> package, which the authors describe as a grammar of data manipulation (in the wrangling sense, not deviously making up data).</p>
<p>The <code>dplyr</code> package contains several key functions based on common English verbs to help you understand what the code is doing. For an overview, we will introduce you to the following functions:</p>
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: center;">Function</th>
<th style="text-align: left;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>*_join()</code></td>
<td style="text-align: left;">Add columns from two data sets by matching observations</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>select()</code></td>
<td style="text-align: left;">Include or exclude certain variables (columns)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>mutate()</code></td>
<td style="text-align: left;">Create new variables (columns)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>arrange()</code></td>
<td style="text-align: left;">Change the order of observations (rows)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code></td>
<td style="text-align: left;">Include or exclude certain observations (rows)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>group_by()</code></td>
<td style="text-align: left;">Organize the observations (rows) into groups</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>summarise()</code></td>
<td style="text-align: left;">Create summary variables for groups of observations</td>
</tr>
</tbody>
</table>
<p>Just looking at the names gives you some idea of what the functions do. For example, <code>select()</code> selects columns and <code>arrange()</code> orders observations. You will be surprised by how far you can get with data wrangling using just these functions. There will always be unique problems to solve, but these functions cover the most common that apply to almost every data set.</p>
<p>In this chapter, we focus on the <code>*_join()</code> series of functions, <code>select()</code>, <code>arrange()</code>, and <code>mutate()</code>.</p>
</section><section id="joining-two-data-frames-with-_join-functions" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="joining-two-data-frames-with-_join-functions">
<span class="header-section-number">4.3</span> Joining two data frames with <code>*_join()</code> functions</h2>
<p>The first thing we will do is combine data files. We have two files, <code>dat</code> and <code>pinfo</code>, but what we really want is a single file that has both the happiness and depression scores and the demographic information about the participants as it makes it easier to work with the combined data.</p>
<p>To do this, we are going to use the function <code>inner_join()</code>. So far, we have described these types of functions as <code>*_join()</code>. This is because there are a series of functions that join two data sets in slightly different ways. You do not need to memorise these, but it might be useful to refer back to later.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 42%">
<col style="width: 57%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">Join function</th>
<th style="text-align: left;">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>inner_join()</code></td>
<td style="text-align: left;">Keep observations in data set 1 that has a matching key in data set 2</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>left_join()</code></td>
<td style="text-align: left;">Keep all observations in data set 1</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>right_join()</code></td>
<td style="text-align: left;">Keep all observations in data set 2</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>full_join()</code></td>
<td style="text-align: left;">Keep all observations in both data set 1 and 2</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>As these functions join data sets in different ways, they will produce different sample sizes depending on the presence of missing data in one or both data sets. For example, <code>inner_join()</code> will be the strictest as you must have matching observations in each data set. On the other hand, <code>full_join()</code> will be the least strict, as you retain observations that may not exist in one data set or the other.</p>
</div>
</div>
<section id="activity-2---join-the-files-together" class="level3" data-number="4.3.1"><h3 data-number="4.3.1" class="anchored" data-anchor-id="activity-2---join-the-files-together">
<span class="header-section-number">4.3.1</span> Activity 2 - Join the files together</h3>
<p>We are going to join <code>dat</code> and <code>pinfo</code> by common identifiers. When we use <code>inner_join()</code>, this means we want to keep all the observations in <code>dat</code> that also has a corresponding identifier in <code>pinfo</code>. This is known as an <strong><a href="https://psyteachr.github.io/glossary/i#inner-join" target="_blank" class="glossary" title="A mutating join that returns all the rows that have a match in the other table.">inner-join</a></strong>, where you would exclude participants if they did not have a matching observation in one of the data sets.</p>
<p>The code below will create a new object, called <code>all_dat</code>, that combines the data from both <code>dat</code> and <code>pinfo</code> using the information in the columns <code>id</code> and <code>intervention</code> to match the participants’ data across the two sets of data. <code>id</code> is a code or number for each unique participant and will be the most common approach you see for creating an identifier. <code>intervention</code> is the group the participant was placed in for the study by <span class="citation" data-cites="woodworth_data_2018">Woodworth et al. (<a href="references.html#ref-woodworth_data_2018" role="doc-biblioref">2018</a>)</span>.</p>
<p>Type and run the code in a new code chunk to inner join the two sets of data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>all_dat <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(<span class="at">x =</span> dat, </span>
<span id="cb3-2"><a href="#cb3-2"></a>                      <span class="at">y =</span> pinfo, </span>
<span id="cb3-3"><a href="#cb3-3"></a>                      <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"intervention"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To break down what this code is doing:</p>
<ul>
<li><p><code>all_dat</code> is the new object you created with the joined data.</p></li>
<li><p><code>x</code> is the first argument and it should be the first data set / object you want to combine.</p></li>
<li><p><code>y</code> is the second argument and it should be the second data set / object you want to combine.</p></li>
<li><p><code>by</code> is the third argument and it lists the identifier as the name(s) of the column(s) you want to combine the data by in quote marks. In this scenario, there are two identifiers common to each data set. They both contain columns called “id” and “intervention”. We have to wrap them in <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> to say that there is more than one column to combine by. If there was only one common identifier, you would write <code>by = "id"</code>.</p></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why does my data include .x and .y columns?
</div>
</div>
<div class="callout-body-container callout-body">
<p>If your data sets have more than one common column, you must enter them all in the <code>by</code> argument. This tells R there are matching columns and values across the data sets. If you do not enter all the common columns, then R will add on a .x and .y when it adds them together, to label which come from each data set.</p>
<p>For example, try and run this code and look at the columns in <code>all_dat2</code>. You will see it has an extra column compared to <code>all_dat</code> as there is both “intervention.x” and “intervention.y”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>all_dat2 <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(<span class="at">x =</span> dat, </span>
<span id="cb4-2"><a href="#cb4-2"></a>                      <span class="at">y =</span> pinfo, </span>
<span id="cb4-3"><a href="#cb4-3"></a>                      <span class="at">by =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Once you have run this code you should now see the <code>all_dat</code> in the environment pane. View the new dataset using one of the methods from Activity 4. In fact, try to remember that you should always view any new object or data that you create. Code often can run but that doesn’t necessarily mean it is correct. The programme only ever knows what the code says not what you thought you said. Get into the habit of always checking output!</p>
</section></section><section id="selecting-variables-of-interest-with-select" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="selecting-variables-of-interest-with-select">
<span class="header-section-number">4.4</span> Selecting variables of interest with <code>select()</code>
</h2>
</section><section id="arranging-variables-of-interest-with-arrange" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="arranging-variables-of-interest-with-arrange">
<span class="header-section-number">4.5</span> Arranging variables of interest with <code>arrange()</code>
</h2>
</section><section id="creating-or-modifying-variables-with-mutate" class="level2" data-number="4.6"><h2 data-number="4.6" class="anchored" data-anchor-id="creating-or-modifying-variables-with-mutate">
<span class="header-section-number">4.6</span> Creating or modifying variables with <code>mutate()</code>
</h2>
</section><section id="six-functions-for-wrangling-the-babynames" class="level2" data-number="4.7"><h2 data-number="4.7" class="anchored" data-anchor-id="six-functions-for-wrangling-the-babynames">
<span class="header-section-number">4.7</span> Six functions for wrangling the <code>babynames</code>
</h2>
<p>Ok so now we have a fairly code understanding of the babynames, let’s use it to learn a bit more about the six functions from <code>dplyr</code> that make up a lot of data wrangling!</p>
<section id="dw1-a4" class="level3" data-number="4.7.1"><h3 data-number="4.7.1" class="anchored" data-anchor-id="dw1-a4">
<span class="header-section-number">4.7.1</span> Activity 4: Selecting variables of interest with <code>select()</code>
</h3>
<p>Often data has a lot of variables we don’t need and it can be easier to focus on just the data we do need. In <code>babynames</code> there are two numeric measurements of name popularity - <code>prop</code>, the proportion of all babies with each name, is probably more useful than <code>n</code>, the total number of babies with that name, because <code>prop</code> takes into account that different numbers of babies are born in different years.</p>
<p>Now as we saw previously, if we wanted to create a dataset that only includes certain variables, we can use the <code>select()</code> function from the <code>dplyr</code> package.</p>
<ul>
<li>In a new code chunk, type and run the below code to select only the columns <code>year</code>, <code>sex</code>, <code>name</code> and <code>prop</code> and store it as a <code>tibble</code> in the object named <code>babynames_reduced</code>.
<ul>
<li>the first argument <code>.data</code> is the object we want to select variables from, in this case <code>babynames</code>
</li>
<li>the additional arguments are the names of the variables you want to <strong>keep</strong>!</li>
</ul>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>babynames_reduced1 <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="at">.data =</span> babynames,</span>
<span id="cb5-2"><a href="#cb5-2"></a>                            year, </span>
<span id="cb5-3"><a href="#cb5-3"></a>                            sex, </span>
<span id="cb5-4"><a href="#cb5-4"></a>                            name, </span>
<span id="cb5-5"><a href="#cb5-5"></a>                            prop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, you can also state which variables you don’t want to keep! This is really handy if you want to keep a lot of columns and only get rid of maybe one or two.</p>
<ul>
<li>Type and run in the below code in a new code chunk.
<ul>
<li>Here, rather than stating you want to keep <code>year</code>, <code>sex</code>, <code>name</code> and <code>prop</code>, we can say drop (i.e.&nbsp;get rid of) the column <code>n</code> using the minus sign <code>-</code> before the variable name.</li>
</ul>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>babynames_reduced2 <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="at">.data =</span> babynames, </span>
<span id="cb6-2"><a href="#cb6-2"></a>                             <span class="sc">-</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Note</strong> that <code>select()</code> does not change the original tibble, <code>babynames</code>, but makes a new object that stores a new tibble with the specified columns, i.e.&nbsp;<code>babynames_reduced1</code> and <code>babynames_reduced2</code>. You will see the new objects in your environment pane. If you don’t save the new tibbles to an object, they won’t be saved. For example, the below code does the same as the previous code but is not saved as the output of the function is not assigned (using the <a href="https://psyteachr.github.io/glossary/a#assignment-operator" target="_blank" class="glossary" title="The symbol <-, which functions like = and assigns the value on the right to the object on the left">assignment operator</a>, <code>&lt;-</code>) to a new object.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">select</span>(<span class="at">.data =</span> babynames, </span>
<span id="cb7-2"><a href="#cb7-2"></a>       <span class="sc">-</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="dw1-a5" class="level3" data-number="4.7.2"><h3 data-number="4.7.2" class="anchored" data-anchor-id="dw1-a5">
<span class="header-section-number">4.7.2</span> Activity 5: Arranging the data with <code>arrange()</code>
</h3>
<p>Superb! We now know how to select variables. Another handy skill is being able to change the order of data in a tibble. The function <code>arrange()</code> will sort the rows in the table according to the columns you supply.</p>
<ul>
<li>Type and run the below code in a new code chunk.
<ul>
<li>the first argument <code>.data</code> again says what object to work on</li>
<li>the second argument says what column to sort the data by - in this instance we are sorting by <code>name</code>
</li>
<li>the default sorting order is ascending!</li>
</ul>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>sort_asc <span class="ot">&lt;-</span> <span class="fu">arrange</span>(<span class="at">.data =</span> babynames,</span>
<span id="cb8-2"><a href="#cb8-2"></a>                    name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you look in <code>sort_asc</code> the data are now sorted in ascending alphabetical order by name. But what if you want the data in descending order? Here we can wrap the name of the variable in the <code>desc()</code> function.</p>
<ul>
<li>Type and run the below code in a new code chunk. When you have run the code have a look at <code>sort_desc</code> and note that the data is now sorted by descending year!</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>sort_desc <span class="ot">&lt;-</span> <span class="fu">arrange</span>(babynames, </span>
<span id="cb9-2"><a href="#cb9-2"></a>                     <span class="fu">desc</span>(year)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, you can also sort by more than one column and a combination of ascending and descending columns. Have a look at th below code and then answer the question below:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">arrange</span>(babynames, </span>
<span id="cb10-2"><a href="#cb10-2"></a>        <span class="fu">desc</span>(year), </span>
<span id="cb10-3"><a href="#cb10-3"></a>        <span class="fu">desc</span>(sex), </span>
<span id="cb10-4"><a href="#cb10-4"></a>        <span class="fu">desc</span>(prop)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
The above code will produce:
<div id="radio_BXSWYLAFJY" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_BXSWYLAFJY" value=""><span>the data sorted by descending year and sex but ascending prop</span></label><label><input type="radio" autocomplete="off" name="radio_BXSWYLAFJY" value=""><span>the data sorted by descending year and prop but ascending sex</span></label><label><input type="radio" autocomplete="off" name="radio_BXSWYLAFJY" value="answer"><span>the data sorted by descending year, sex and prop</span></label><label><input type="radio" autocomplete="off" name="radio_BXSWYLAFJY" value=""><span>the data sorted by ascending year, sex and prop</span></label>
</div>
<div class="webex-solution">
<button>
Explain this answer
</button>
<p>As all the columns stated are wrapped in the <code>desc()</code> function inside the <code>arrange()</code> function then all columns will be sorted in descending fashion, sorting the year first, then the sex, then the prop. Note however that the output is not being stored at all in a new object so you would not be able to work on the data later without saving it in an object first!</p>
</div>
</section><section id="dw1-a7" class="level3" data-number="4.7.3"><h3 data-number="4.7.3" class="anchored" data-anchor-id="dw1-a7">
<span class="header-section-number">4.7.3</span> Activity 7: Creating new variables with <code>mutate()</code>
</h3>
<p>Doing really well! Only a little more to go we promise! OK so we have really learnt a lot about changing the data we have but sometimes we need to create a new variable that doesn’t exist in our dataset. For instance, we might want to figure out what decade a particular year belongs to in out babynames data and add that to our data! To create new variables, we use the function <code>mutate()</code>.</p>
<ul>
<li>Type and run the below code in a new code chunk.
<ul>
<li>Here, you are mutating a new column onto the data and storing it in the object <code>baby_decades</code>
</li>
<li>the first argument is the original data, <code>babynames</code>
</li>
<li>the second argument is the name of the new column <code>decade</code> followed by what you want in that column - the decade.</li>
<li>we are creating the decades using the code `floor(year/10)*10. This seems complicated but it says take the year and divide by 10, then get rid of the decimal places, and then multiply by 10. So for example, 1945/10 = 194.5, and if you get rid of the decimal places that becomes 194, and multiply it by 10 gives you 1940s!.</li>
</ul>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>baby_decades <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="at">.data =</span> babynames,</span>
<span id="cb11-2"><a href="#cb11-2"></a>                  <span class="at">decade =</span> <span class="fu">floor</span>(year<span class="sc">/</span><span class="dv">10</span>) <span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a>baby_decades</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The start of the data will look something like this with the new column called <code>decade</code> mutated on:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">sex</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">prop</th>
<th style="text-align: right;">decade</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Mary</td>
<td style="text-align: right;">7065</td>
<td style="text-align: right;">0.0723836</td>
<td style="text-align: right;">1880</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Anna</td>
<td style="text-align: right;">2604</td>
<td style="text-align: right;">0.0266790</td>
<td style="text-align: right;">1880</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Emma</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">0.0205215</td>
<td style="text-align: right;">1880</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Elizabeth</td>
<td style="text-align: right;">1939</td>
<td style="text-align: right;">0.0198658</td>
<td style="text-align: right;">1880</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Minnie</td>
<td style="text-align: right;">1746</td>
<td style="text-align: right;">0.0178884</td>
<td style="text-align: right;">1880</td>
</tr>
<tr class="even">
<td style="text-align: right;">1880</td>
<td style="text-align: left;">F</td>
<td style="text-align: left;">Margaret</td>
<td style="text-align: right;">1578</td>
<td style="text-align: right;">0.0161672</td>
<td style="text-align: right;">1880</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>But mutates can be much simpler like this example here. Have a look at the code and then answer the question below:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>baby_where <span class="ot">&lt;-</span> <span class="fu">mutate</span>(<span class="at">.data =</span> babynames,</span>
<span id="cb12-2"><a href="#cb12-2"></a>                  <span class="at">country =</span> <span class="st">"USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
What will be stored in the object <code>baby_where</code>?
<div id="radio_XIAKHRLDRA" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_XIAKHRLDRA" value=""><span>a tibble with one column called country that contains the decade people were born</span></label><label><input type="radio" autocomplete="off" name="radio_XIAKHRLDRA" value="answer"><span>a tibble with all the original data and a new column called country stating USA</span></label><label><input type="radio" autocomplete="off" name="radio_XIAKHRLDRA" value=""><span>a tibble with all the original data and a new column stating usa</span></label><label><input type="radio" autocomplete="off" name="radio_XIAKHRLDRA" value=""><span>a tibble with all the original data arranged by the country USA</span></label>
</div>
<div class="webex-solution">
<button>
Explain this Answer
</button>
<p>This code will create a new object storing a tibble that has all the original data and a new column called country that states USA for each row. The <code>mutate()</code> adds to what is already there unless you add a <code>select()</code> or <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to remove columns or rows. Note that one of the answers is wrong because it states usa in lowercase but the code states it in uppercase, i.e.&nbsp;USA. Remember to be specific.</p>
</div>
</section></section><section id="ld-test" class="level2" data-number="4.8"><h2 data-number="4.8" class="anchored" data-anchor-id="ld-test">
<span class="header-section-number">4.8</span> Test yourself</h2>
<p>To end the chapter, we have some knowledge check questions to test your understanding of the concepts we covered in the chapter. We then have some error mode tasks to see if you can find the solution to some common errors in the concepts we covered in this chapter.</p>
<section id="knowledge-check" class="level3" data-number="4.8.1"><h3 data-number="4.8.1" class="anchored" data-anchor-id="knowledge-check">
<span class="header-section-number">4.8.1</span> Knowledge check</h3>
<ol type="1">
<li>Which of the following is not one of the Wickham Six functions?
<div id="radio_JUOPWXMRXT" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_JUOPWXMRXT" value="answer"><span>melt()</span></label><label><input type="radio" autocomplete="off" name="radio_JUOPWXMRXT" value=""><span>arrange()</span></label><label><input type="radio" autocomplete="off" name="radio_JUOPWXMRXT" value=""><span>mutate()</span></label><label><input type="radio" autocomplete="off" name="radio_JUOPWXMRXT" value=""><span>filter()</span></label>
</div>
</li>
<li>Which of the following functions would I use if I wanted to keep only certain columns?
<div id="radio_LOXRUVIKGY" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_LOXRUVIKGY" value="answer"><span>select()</span></label><label><input type="radio" autocomplete="off" name="radio_LOXRUVIKGY" value=""><span>arrange()</span></label><label><input type="radio" autocomplete="off" name="radio_LOXRUVIKGY" value=""><span>mutate()</span></label><label><input type="radio" autocomplete="off" name="radio_LOXRUVIKGY" value=""><span>filter()</span></label>
</div>
</li>
<li>Which of the following functions would I use if I wanted to keep only certain rows?
<div id="radio_IMATULPLME" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_IMATULPLME" value=""><span>select()</span></label><label><input type="radio" autocomplete="off" name="radio_IMATULPLME" value=""><span>arrange()</span></label><label><input type="radio" autocomplete="off" name="radio_IMATULPLME" value=""><span>mutate()</span></label><label><input type="radio" autocomplete="off" name="radio_IMATULPLME" value="answer"><span>filter()</span></label>
</div>
</li>
<li>Which of the following functions would I use if I wanted to add a new column of information?
<div id="radio_VVLUJCBRWM" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_VVLUJCBRWM" value=""><span>select()</span></label><label><input type="radio" autocomplete="off" name="radio_VVLUJCBRWM" value=""><span>arrange()</span></label><label><input type="radio" autocomplete="off" name="radio_VVLUJCBRWM" value="answer"><span>mutate()</span></label><label><input type="radio" autocomplete="off" name="radio_VVLUJCBRWM" value=""><span>filter()</span></label>
</div>
</li>
<li>Which boolean expression would I add to a <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function to keep only Male babies in the original <code>babynames</code> data?
<div id="radio_GINKJQXPEN" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_GINKJQXPEN" value=""><span>sex == F</span></label><label><input type="radio" autocomplete="off" name="radio_GINKJQXPEN" value="answer"><span>sex == M</span></label><label><input type="radio" autocomplete="off" name="radio_GINKJQXPEN" value=""><span>sex &lt; F</span></label><label><input type="radio" autocomplete="off" name="radio_GINKJQXPEN" value=""><span>Sex == M</span></label>
</div>
</li>
</ol>
<div class="webex-solution">
<button>
Explain these Answers
</button>
<ol type="1">
<li>
<code>melt()</code> is not a function in the Wickham six functions. It is actually a function but not one we tend to use.</li>
<li>
<code>select()</code> is the function for keeping and removing columns.</li>
<li>
<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> is the function for keeping and removing rows.</li>
<li>
<code>mutate()</code> is the function for adding new columns.</li>
<li>Assuming the original data has not been changed, <code>"sex == M"</code> would work and not <code>"Sex == M"</code> as there is no column called Sex with an uppercase S. Remember to be exact.</li>
</ol>
</div>
</section><section id="error-mode" class="level3" data-number="4.8.2"><h3 data-number="4.8.2" class="anchored" data-anchor-id="error-mode">
<span class="header-section-number">4.8.2</span> Error mode</h3>
<p>The following questions are designed to introduce you to making and fixing errors. For this topic, we focus on reading data and using ggplot2. Remember to keep a note of what kind of error messages you receive and how you fixed them, so you have a bank of solutions when you tackle errors independently.</p>
<p>Create and save a new R Markdown file for these activities by following the instructions in Chapter 2. You should have a blank R Markdown file below line 10. Below, we have several variations of a code chunk and inline code errors. Copy and paste them into your R Markdown file, click knit, and look at the error message you receive. See if you can fix the error and get it working before checking the answer.</p>
<ol type="1">
<li>Restart the R session (<strong><code>Session &gt;&gt; Restart R</code></strong>). Make sure that the working directory is set to the right folder and then run the below code in your console window:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>babynames</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will produce the error:</p>
<pre><code>Error: object 'babynames' not found</code></pre>
<p>Once you figure out how to fix this error, make a note of it.</p>
<div class="webex-solution">
<button>
Solution
</button>
<p>This is an indication that you have not loaded the <code>babynames</code> package into the library using the <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> function</p>
</div>
<p><br></p>
<ol start="2" type="1">
<li>Restart the R session (<strong><code>Session &gt;&gt; Restart R</code></strong>). Make sure that the working directory is set to the right folder and then run the below code in your console window:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>dat <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="at">.data =</span> babynames, <span class="at">mean_n =</span> <span class="fu">mean</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will produce the error:</p>
<pre><code>Error in summarise(.data = babynames, mean_n = mean(n)) : 
  could not find function "summarise"</code></pre>
<p>Once you figure out how to fix this error, make a note of it.</p>
<div class="webex-solution">
<button>
Solution
</button>
<p>What the error is saying is that there is no function called <code>summarise()</code>. You know that function exists though. What you have not done is call load the function into the libary using <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code></p>
</div>
<p><br></p>
<ol start="3" type="1">
<li>Restart the R session (<strong><code>Session &gt;&gt; Restart R</code></strong>). Make sure that the working directory is set to the right folder and then run the below code in your console window:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a>dat <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="at">.data =</span> babynames <span class="at">mean_n =</span> <span class="fu">mean</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will produce the error:</p>
<pre><code>Error: unexpected symbol in "dat &lt;- summarise(.data = babynames mean_n"
</code></pre>
<p>Once you figure out how to fix this error, make a note of it.</p>
<div class="webex-solution">
<button>
Solution
</button>
<p>This is actually one of the most painful errors you can see as it doesn’t really help you solve your issue because it is not quite clear what it means. <strong>unexpected symbol</strong> means effectively that the code is wrong and it is seeing something it did not think it would see. Again not that clear right? What we do when we see this is ask ourselves have we forgotten a comma somewhere or maybe a bracket or a quotation mark! Look for those issues and see if that helps. The error does show you that the error comes between <code>babynames</code> and <code>mean_n</code> it just isn’t clear that that is what it means. The issue will be around the last word it mentions basically. The answer here is that there is a comma missing between the data and the arguement; between <code>babynames</code> and <code>mean_n</code>. The line should read:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a>dat <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="at">.data =</span> babynames, <span class="at">mean_n =</span> <span class="fu">mean</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again an incredibly frustrating and time consuming error. Watch out for these. It is why partitioning the code on to new lines after a comma can be really help see errors as such:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>dat <span class="ot">&lt;-</span> <span class="fu">summarise</span>(<span class="at">.data =</span> babynames, </span>
<span id="cb20-5"><a href="#cb20-5"></a>                 <span class="at">mean_n =</span> <span class="fu">mean</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Such a dastardly error! Well done if you spotted it!!!</p>
</div>
<p><br></p>
</section></section><section id="words-from-this-chapter" class="level2" data-number="4.9"><h2 data-number="4.9" class="anchored" data-anchor-id="words-from-this-chapter">
<span class="header-section-number">4.9</span> Words from this Chapter</h2>
<p>Below you will find a list of words that were used in this chapter that might be new to you in case it helps to have somewhere to refer back to what they mean. The links in this table take you to the entry for the words in the <a href="https://psyteachr.github.io/glossary/" target="_blank">PsyTeachR Glossary</a>. Note that the Glossary is written by numerous members of the team and as such may use slightly different terminology from that shown in the chapter.</p>
<div class="cell" data-layout-align="center">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: left;">definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/a#assignment-operator" class="glossary" target="_blank">assignment-operator</a></td>
<td style="text-align: left;">The symbol &lt;-, which functions like = and assigns the value on the right to the object on the left</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/d#data-wrangling" class="glossary" target="_blank">data-wrangling</a></td>
<td style="text-align: left;">The process of preparing data for visualisation and statistical analysis.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/f#function" class="glossary" target="_blank">function</a></td>
<td style="text-align: left;">A named section of code that can be reused.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/i#inner-join" class="glossary" target="_blank">inner-join</a></td>
<td style="text-align: left;">A mutating join that returns all the rows that have a match in the other table.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/p#package" class="glossary" target="_blank">package</a></td>
<td style="text-align: left;">A group of R functions.</td>
</tr>
</tbody>
</table>
</div>
</section><section id="end-of-chapter" class="level2" data-number="4.10"><h2 data-number="4.10" class="anchored" data-anchor-id="end-of-chapter">
<span class="header-section-number">4.10</span> End of Chapter</h2>
<p>That is end of this chapter. Be sure to look again at anything you were unsure about and make some notes to help develop your own knowledge and skills. It would be good to write yourself some questions about what you are unsure of and see if you can answer them later or speak to someone about them. Good work today!</p>
<p>Brilliant! That has been a lot of information but hopefully it has started to give you a sense of some of the approaches to data wrangling and the main functions we will use as we get deeper into the book!</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-dasu2003" class="csl-entry" role="listitem">
Dasu, T., &amp; Johnson, T. (2003). <em>Exploratory data mining and data cleaning</em>. Wiley-Interscience.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, H. (2017). <em>Tidyverse: Easily install and load the ’tidyverse’</em>. <a href="https://CRAN.R-project.org/package=tidyverse">https://CRAN.R-project.org/package=tidyverse</a>
</div>
<div id="ref-woodworth_data_2018" class="csl-entry" role="listitem">
Woodworth, R. J., O’Brien-Malone, A., Diamond, M. R., &amp; Schüz, B. (2018). Data from, <span>“<span>Web</span>-based <span>Positive</span> <span>Psychology</span> <span>Interventions</span>: <span>A</span> <span>Reexamination</span> of <span>Effectiveness</span>.”</span> <em>Journal of Open Psychology Data</em>, <em>6</em>(1), 1. <a href="https://doi.org/10.5334/jopd.35">https://doi.org/10.5334/jopd.35</a>
</div>
</div>
</section></main><!-- /main --><script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script><script>
// open rdrr links externally ----

var exlinks = document.querySelectorAll("a[href^='https://rdrr.io']");
var exlink_func = function(){
  window.open(this.href);
  return false;
};
for (var i = 0; i < exlinks.length; i++) {
    exlinks[i].addEventListener('click', exlink_func, false);
}

// visible second sidebar in mobile ----

function move_sidebar() {
  var toc = document.getElementById("TOC");
  var small_sidebar = document.querySelector("#quarto-sidebar .sidebar-menu-container");
  var right_sidebar = document.getElementById("quarto-margin-sidebar");

  if (window.innerWidth < 768) {
    small_sidebar.append(toc);
  } else {
    right_sidebar.append(toc);
  }
}
move_sidebar();
window.onresize = move_sidebar;
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./03-intro-data-viz.html" class="pagination-link" aria-label="Introduction to Data Visualisation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Data Visualisation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05-wrangling-2.html" class="pagination-link" aria-label="Data wrangling 2: Filter, summarise, and pipes">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data wrangling 2: Filter, summarise, and pipes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>CC-BY (2024) James Bartlett &amp; Wil Toivo</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/BartlettJE/quant-fun-v3/edit/main/04-wrangling-1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/BartlettJE/quant-fun-v3/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/BartlettJE/quant-fun-v3/blob/main/04-wrangling-1.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>